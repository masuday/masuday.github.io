<!DOCTYPE html>
<!--==============================================================================
	           "GitHub HTML5 Pandoc Template" v1.2 — by Tristano Ajmone
	==============================================================================
	(c) Tristano Ajmone, 2017, MIT License (MIT). Project's home repository:

	- https://github.com/tajmone/pandoc-goodies

	This template reuses source code taken from the following projects:

	- GitHub Markdown CSS: © Sindre Sorhus, MIT License (MIT):
	  https://github.com/sindresorhus/github-markdown-css

	- Primer CSS: © 2016 GitHub Inc., MIT License (MIT):
	  http://primercss.io/
	==============================================================================-->
<html>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Yutaka Masuda" />
  <title>Pointers</title>
  <style type="text/css">@font-face{font-family:octicons-link;src:url(data:font/woff;charset=utf-8;base64,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) format('woff')}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:16px;line-height:1.5;word-wrap:break-word;box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px}.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body a{background-color:transparent;-webkit-text-decoration-skip:objects;color:#0366d6;text-decoration:none}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body svg:not(:root){overflow:hidden}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace}.markdown-body input{font:inherit;margin:0;overflow:visible;font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{box-sizing:content-box;overflow:hidden;background:0 0;border-bottom:1px solid #dfe2e5}.markdown-body hr::before{display:table;content:""}.markdown-body hr::after{display:table;clear:both;content:""}.markdown-body table{border-spacing:0;border-collapse:collapse;display:block;width:100%;overflow:auto}.markdown-body td,.markdown-body th{padding:0}.markdown-body blockquote{margin:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code{font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace}.markdown-body pre{font:12px SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace;word-wrap:normal}.markdown-body .pl-0{padding-left:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body::before{display:table;content:""}.markdown-body::after{display:table;clear:both;content:""}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:0}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd{font-size:11px;box-shadow:inset 0 -1px 0 #959da5}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1{padding-bottom:.3em;font-size:2em;border-bottom:1px solid #eaecef}.markdown-body h2{padding-bottom:.3em;font-size:1.5em;border-bottom:1px solid #eaecef}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fcfcfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown-body hr{border-bottom-color:#eee}.flash{position:relative;padding:16px;color:#246;background-color:#e2eef9;border:1px solid #bac6d3;border-radius:3px}.flash p:last-child{margin-bottom:0}.flash-messages{margin-bottom:24px}.flash-warn{color:#4c4a42;background-color:#fff9ea;border-color:#dfd8c2}.flash-error{color:#911;background-color:#fcdede;border-color:#d2b2b2}.flash-success{color:#22662c;background-color:#e2f9e5;border-color:#bad3be}.flash-plain{color:#4c4a42;background-color:#f5f5f5;border-color:#c1c1c1}</style>
  <style type="text/css">:not(pre) > code{white-space: pre; background-color: #faf7f5;}</style>
  <style type="text/css">pre[data-language='renumf90']{background-color:#EFEFFE;}</style>
  <style type="text/css">pre[data-language='Fortran']{background-color:#E7FFE7;}</style>
  <style type="text/css">pre[data-language='output']{background-color:#FFFFFF;border:thin solid black;}</style>
  <style type="text/css">pre[data-language='shell']{background-color:#FFFFFF;border:thin dashed;}</style>
  <style type="text/css">pre[data-caption]::before{content:attr(data-caption) "\a\a";font-size:large;font-weight:bold;border-bottom:thin solid black}</style>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link rel="stylesheet" href="prism.css">
  <script type="text/javascript" src="prism.js"></script>
</head>
</head>
<body>
<article class="markdown-body">
<header>
<h1 class="title">Pointers</h1>
<p class="author">Yutaka Masuda</p>
<p class="date">February 2020</p>
</header>
<nav id="TOC">
<ul>
<li><a href="#pointers">Pointers</a>
<ul>
<li><a href="#pointer-as-an-association-to-a-variable">Pointer as an association to a variable</a></li>
<li><a href="#pointer-to-a-subarray">Pointer to a subarray</a></li>
<li><a href="#pointer-to-free-memory">Pointer to free memory</a></li>
</ul></li>
</ul>
</nav>
<p>
Back to <a href="./index.html">index.html</a>.
</p>
<h1 id="pointers">Pointers</h1>
<h2 id="pointer-as-an-association-to-a-variable">Pointer as an association to a variable</h2>
<h3 id="motivation">Motivation</h3>
<p>In some cases, you may want to refer to a variable by a different name. A pointer is a separate variable to refer to the existing variable. It is useful to put an alternative name to the variable.</p>
<h3 id="pointing-to-a-variable">Pointing to a variable</h3>
<p>For example, you have an integer array <code>config(5)</code>, and it contains a set of configurations (e.g., the number of records) essential for your procedure. You can see the “number of records” in <code>config(2)</code>, but <code>2</code> is a magic number, so it is awkward. One solution is to define a parameter like <code>number_of_records=2</code> and to use <code>config(number_of_records)</code>. It is meaningful, but the identifier is too long in some cases.</p>
<p>You can use a pointer to <em>point to</em> <code>config(2)</code>. The pointer is a “shortcut” or an “alias” to the original variable. The following program declares a pointer, <code>number_of_records</code>, that is associated with the original variable, <code>config(5)</code>.</p>
<pre data-language="Fortran"><code class="language-fortran">integer,target :: config(5)=[10,20,30,40,50]
integer,pointer :: number_of_records

! The pointer is associated with the element.
number_of_records =&gt; a(2)

! Use a pointer like a variable
print *,number_of_records</code></pre>
<pre data-language="output"><code>        20</code></pre>
<p>A variable to be referred (<code>config</code>) must have the <code>target</code> attribute on the declaration. A pointer has the same type as the target. The declaration of a pointer is the same as a variable except for the <code>pointer</code> attribute. To associate a pointer to the target variable, use <code>=&gt;</code>. After the association, you can use the pointer like a variable.</p>
<pre data-language="definition"><code class="language-fortran">pointer_variable =&gt; target_variable</code></pre>
<h3 id="updating-the-pointer-or-the-original-variable">Updating the pointer or the original variable</h3>
<p>As seen above, a pointer is just pointing to the original value (<code>number_of_records</code> refers to <code>config(2)</code>, which has the value, <code>20</code>). Therefore, when you change the target variable, the pointer returns the updated value. Inversely, when you assign a value to the pointer, the target variable changes.</p>
<pre data-language="Fortran"><code class="language-fortran">! update the original variable
config(2) = 99
print *,number_of_records

! assign a value to the pointer changing the original variable as well
number_of_records = 0
print *,config</code></pre>
<pre data-language="output"><code>          99
          10           0          30          40          50</code></pre>
<h3 id="re-association-of-the-pointer">Re-association of the pointer</h3>
<p>You can immediately change the target of a pointer.</p>
<pre data-language="Fortran"><code class="language-fortran">number_of_records =&gt; config(5)
print *,number_of_records</code></pre>
<pre data-language="output"><code>          50</code></pre>
<h3 id="null-pointer">Null pointer</h3>
<p>When a pointer is not associated with anything, you must not use it. If you initialize the pointer (i.e., referring to the “null” target), use <code>null()</code> or <code>nullify()</code>. See the following usage.</p>
<pre data-language="Fortran"><code class="language-fortran">! initialization in declaration
integer,pointer :: number_of_records =&gt; null()

! initialization in the main body
nullify(number_of_records)</code></pre>
<p>You can use <code>associated()</code> to test whether a pointer is associated or not.</p>
<table>
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="header">
<th>name</th>
<th>description</th>
<th>example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>associated(p)</code></td>
<td>test if pointer <code>p</code> is associated or not</td>
<td><code>associated(number_of_records)</code></td>
</tr>
</tbody>
</table>
<h3 id="summary">Summary</h3>
<ul>
<li>A pointer is an alias to a target variable.</li>
<li>The target variable has the <code>target</code> attribute in the declaration.</li>
<li>The pointer is declared as a variable (with the <code>pointer</code> attribute) as the same type as the target.</li>
<li>The pointer is associated with the target by <code>=&gt;</code> before using the pointer.</li>
<li>You can use a pointer as a regular variable.</li>
<li>Changing the target variable changes the pointer value and vice versa.</li>
<li>You can use <code>null()</code> or <code>nullify()</code> to disassociate the pointer. Use <code>associate()</code> to test if the pointer is associated or not.</li>
</ul>
<h2 id="pointer-to-a-subarray">Pointer to a subarray</h2>
<p>A pointer is useful to point to a subarray. See the following code.</p>
<pre data-language="Fortran"><code class="language-fortran">integer,target :: config(5)=[10,20,30,40,50]
integer,pointer :: p(:) =&gt; null()

! case 1
p =&gt; config
print *,p

! case 2
p =&gt; config(2:4)
print *,p

! case 3
p =&gt; config(1:5:2)
print *,p</code></pre>
<pre data-language="output"><code>          10          20          30          40          50
          20          30          40
          10          30          50</code></pre>
<p>The pointer to an array should have the same dimension, <code>(:)</code>, as the target array. The pointer declaration looks like an allocatable array.</p>
<p>It is useful to refer to a submatrix. Here is an example define a pointer to <code>(2:3,2:3)</code> of the following matrix.</p>
<p><span class="math display">\[
\left[
\begin{array}{ccc}
1&amp;4&amp;7\\
2&amp;5&amp;8\\
3&amp;6&amp;9
\end{array}
\right]
\]</span></p>
<pre data-language="Fortran"><code class="language-fortran">integer,target :: mat(3,3)
integer,pointer :: p(:,:)

mat = reshape([1,2,3,4,5,6,7,8,9],shape(mat))

! case 4
p =&gt; mat(2:3,2:3)
print *,p</code></pre>
<pre data-language="output"><code>           5           6           8           9</code></pre>
<p>Using a pointer is to reach the target by indirect access. This fact penalizes the speed and the memory requirement to store the pointer. If the target is contiguous (cases 1 and 2), the speed loss is minimal, and no extra memory is needed. However, the target is not contiguous (cases 3 and 4); the penalty may be substantial. A best practice is: do not abuse a pointer to a non-contiguous array.</p>
<h2 id="pointer-to-free-memory">Pointer to free memory</h2>
<p>The other usage of a pointer is to refer to free memory. It is the same as an allocatable array – you can allocate the pointer array before using it and deallocate it after the use. See the following code.</p>
<pre data-language="Fortran"><code class="language-fortran">integer,pointer :: p(:)

allocate(p(3))
p(1:3) = [1,2,3]
print *,p
deallocate(p)</code></pre>
<p>Here is the difference.</p>
<table>
<thead>
<tr class="header">
<th>Difference</th>
<th>Allocatable</th>
<th>Pointer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Deallocation at the end of program unit</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr class="even">
<td>Allocating contiguous memory</td>
<td>Yes</td>
<td>No</td>
</tr>
<tr class="odd">
<td>Inquiring the allocation</td>
<td><code>allocated()</code></td>
<td><code>associated()</code></td>
</tr>
</tbody>
</table>
<p>The allocatable array will be deallocated automatically, when you exit the program unit that has the declaration of the pointer. The pointer array is not released automatically. Instead, you should deallocate it by yourself; otherwise, it stays in memory until the main program stops. If you fail to do it, the occupied memory becomes garbage (i.e., memory leak).</p>
<p>The allocatable array can use the contiguous memory that can contribute to the performance. The pointer array does not guarantee the continuity, and it may affect the speed. Old programs used pointer arrays in a derived-type because Fortran 90/95 did not allow the derived-type to have allocatable arrays; the pointer array was allowed.</p>
<p>My recommendation is that you should always use the allocatable array to assign free memory because it is safer and better in performance.</p>
<p>
Back to <a href="./index.html">index.html</a>.
</p>
</article>
</body>
</html>
