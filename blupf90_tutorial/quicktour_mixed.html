<!DOCTYPE html>
<!--==============================================================================
	           "GitHub HTML5 Pandoc Template" v1.2 — by Tristano Ajmone
	==============================================================================
	(c) Tristano Ajmone, 2017, MIT License (MIT). Project's home repository:

	- https://github.com/tajmone/pandoc-goodies

	This template reuses source code taken from the following projects:

	- GitHub Markdown CSS: © Sindre Sorhus, MIT License (MIT):
	  https://github.com/sindresorhus/github-markdown-css

	- Primer CSS: © 2016 GitHub Inc., MIT License (MIT):
	  http://primercss.io/
	==============================================================================-->
<html>
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Yutaka Masuda" />
  <title>Quick tour of BLUPF90</title>
  <style type="text/css">@font-face{font-family:octicons-link;src:url(data:font/woff;charset=utf-8;base64,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) format('woff')}.markdown-body{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;color:#24292e;font-family:-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";font-size:16px;line-height:1.5;word-wrap:break-word;box-sizing:border-box;min-width:200px;max-width:980px;margin:0 auto;padding:45px}.markdown-body .octicon{display:inline-block;fill:currentColor;vertical-align:text-bottom}.markdown-body a{background-color:transparent;-webkit-text-decoration-skip:objects;color:#0366d6;text-decoration:none}.markdown-body a:active,.markdown-body a:hover{outline-width:0}.markdown-body h1{margin:.67em 0}.markdown-body img{border-style:none}.markdown-body svg:not(:root){overflow:hidden}.markdown-body code,.markdown-body kbd,.markdown-body pre{font-family:monospace,monospace}.markdown-body input{font:inherit;margin:0;overflow:visible;font-family:inherit;font-size:inherit;line-height:inherit}.markdown-body [type=checkbox]{box-sizing:border-box;padding:0}.markdown-body *{box-sizing:border-box}.markdown-body a:hover{text-decoration:underline}.markdown-body strong{font-weight:600}.markdown-body hr{box-sizing:content-box;overflow:hidden;background:0 0;border-bottom:1px solid #dfe2e5}.markdown-body hr::before{display:table;content:""}.markdown-body hr::after{display:table;clear:both;content:""}.markdown-body table{border-spacing:0;border-collapse:collapse;display:block;width:100%;overflow:auto}.markdown-body td,.markdown-body th{padding:0}.markdown-body blockquote{margin:0}.markdown-body ol ol,.markdown-body ul ol{list-style-type:lower-roman}.markdown-body ol ol ol,.markdown-body ol ul ol,.markdown-body ul ol ol,.markdown-body ul ul ol{list-style-type:lower-alpha}.markdown-body dd{margin-left:0}.markdown-body code{font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace}.markdown-body pre{font:12px SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace;word-wrap:normal}.markdown-body .pl-0{padding-left:0!important}.markdown-body .pl-1{padding-left:4px!important}.markdown-body .pl-2{padding-left:8px!important}.markdown-body .pl-3{padding-left:16px!important}.markdown-body .pl-4{padding-left:24px!important}.markdown-body .pl-5{padding-left:32px!important}.markdown-body .pl-6{padding-left:40px!important}.markdown-body::before{display:table;content:""}.markdown-body::after{display:table;clear:both;content:""}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:0}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e1e4e8;border:0}.markdown-body blockquote{padding:0 1em;color:#6a737d;border-left:.25em solid #dfe2e5}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body kbd{font-size:11px;box-shadow:inset 0 -1px 0 #959da5}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.markdown-body h1 .octicon-link,.markdown-body h2 .octicon-link,.markdown-body h3 .octicon-link,.markdown-body h4 .octicon-link,.markdown-body h5 .octicon-link,.markdown-body h6 .octicon-link{color:#1b1f23;vertical-align:middle;visibility:hidden}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .octicon-link,.markdown-body h2:hover .anchor .octicon-link,.markdown-body h3:hover .anchor .octicon-link,.markdown-body h4:hover .anchor .octicon-link,.markdown-body h5:hover .anchor .octicon-link,.markdown-body h6:hover .anchor .octicon-link{visibility:visible}.markdown-body h1{padding-bottom:.3em;font-size:2em;border-bottom:1px solid #eaecef}.markdown-body h2{padding-bottom:.3em;font-size:1.5em;border-bottom:1px solid #eaecef}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#6a737d}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:600}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table th{font-weight:600}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #dfe2e5}.markdown-body table tr{background-color:#fff;border-top:1px solid #c6cbd1}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body code{padding:.2em 0;margin:0;font-size:85%;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code::after,.markdown-body code::before{letter-spacing:-.2em;content:"\00a0"}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:0 0;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f6f8fa;border-radius:3px}.markdown-body pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code::after,.markdown-body pre code::before{content:normal}.markdown-body .full-commit .btn-outline:not(:disabled):hover{color:#005cc5;border-color:#005cc5}.markdown-body kbd{display:inline-block;padding:3px 5px;font:11px SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace;line-height:10px;color:#444d56;vertical-align:middle;background-color:#fcfcfc;border:1px solid #c6cbd1;border-bottom-color:#959da5;border-radius:3px;box-shadow:inset 0 -1px 0 #959da5}.markdown-body :checked+.radio-label{position:relative;z-index:1;border-color:#0366d6}.markdown-body .task-list-item{list-style-type:none}.markdown-body .task-list-item+.task-list-item{margin-top:3px}.markdown-body .task-list-item input{margin:0 .2em .25em -1.6em;vertical-align:middle}.markdown-body hr{border-bottom-color:#eee}.flash{position:relative;padding:16px;color:#246;background-color:#e2eef9;border:1px solid #bac6d3;border-radius:3px}.flash p:last-child{margin-bottom:0}.flash-messages{margin-bottom:24px}.flash-warn{color:#4c4a42;background-color:#fff9ea;border-color:#dfd8c2}.flash-error{color:#911;background-color:#fcdede;border-color:#d2b2b2}.flash-success{color:#22662c;background-color:#e2f9e5;border-color:#bad3be}.flash-plain{color:#4c4a42;background-color:#f5f5f5;border-color:#c1c1c1}</style>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">pre[data-language='renumf90']{background-color:#EFEFFE;}</style>
  <style type="text/css">pre[data-language='blupf90']{background-color:#E7FFE7;}</style>
  <style type="text/css">pre[data-language='output']{background-color:#FFFFFF;border:thin solid black;}</style>
  <style type="text/css">pre[data-language='shell']{background-color:#FFFFFF;border:thin dashed;}</style>
  <style type="text/css">pre[data-caption]::before{content:attr(data-caption) "\a\a";font-size:large;font-weight:bold;border-bottom:thin solid black}</style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML-full" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<article class="markdown-body">
<header>
<h1 class="title">Quick tour of BLUPF90</h1>
<p class="author">Yutaka Masuda</p>
<p class="date">September 2019</p>
</header>
<nav id="TOC">
<ul>
<li><a href="#trivial-analyses-for-mixed-models">Trivial analyses for mixed models</a><ul>
<li><a href="#a-simple-mixed-model">A simple mixed model</a></li>
<li><a href="#the-animal-model">The animal model</a></li>
<li><a href="#more-than-1-random-effect">More than 1 random effect</a></li>
<li><a href="#remarks">Remarks</a></li>
<li><a href="#summary">Summary</a></li>
</ul></li>
</ul>
</nav>
<h1 id="trivial-analyses-for-mixed-models">Trivial analyses for mixed models</h1>
<p>In this section, we perform mixed model analyses using BLUPF90. We start with a simple mixed model (random effects, unrelated to each other) and finally consider pedigree information.</p>
<p>If you perform the simple mixed model, BLUPF90 needs only 2 files (data and parameter file), which are the same as explained in the previous section. If you consider pedigree, in addition to the data and the parameter file, a pedigree file has to be prepared.</p>
<h2 id="a-simple-mixed-model">A simple mixed model</h2>
<p>We assume the similar model described in the previous section and the second effect is now a random effect as <span class="math display">\[
y_{ijk} = A_i + S_j + \beta x_{ijk} + e_{ijk}
\]</span> where <span class="math inline">\(y_{ijk}\)</span> is an observation, <span class="math inline">\(A_i\)</span> is a fixed effect, <span class="math inline">\(S_j\)</span> is a random effect, <span class="math inline">\(\beta\)</span> is a regression coefficient, <span class="math inline">\(x_{ijk}\)</span> is a covariate, and <span class="math inline">\(e_{ij}\)</span> is the residual effect. The model in matrix notation will be <span class="math display">\[
\mathbf{y} = \mathbf{Xb} + \mathbf{Zu} + \mathbf{e}
\]</span> where <span class="math inline">\(\mathbf{y}\)</span> is a vector of observations, <span class="math inline">\(\mathbf{b}\)</span> is a vector of fixed effects, <span class="math inline">\(\mathbf{u}\)</span> is a vector of random effects, <span class="math inline">\(\mathbf{e}\)</span> is a vector of residuals, <span class="math inline">\(\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}\)</span> are incidence matrices. In a general form, we can write <span class="math inline">\(\mathrm{var}(\mathbf{u}) = \mathbf{G}\)</span><a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and <span class="math inline">\(\mathrm{var}(\mathbf{e}) = \mathbf{R}\)</span> and the mixed model equations should be <span class="math display">\[
\left[
\begin{array}{ll}
\mathbf{X}&#39;\mathbf{R}^{-1}\mathbf{X} &amp; \mathbf{X}&#39;\mathbf{R}^{-1}\mathbf{Z} \\
\mathbf{Z}&#39;\mathbf{R}^{-1}\mathbf{X} &amp; \mathbf{Z}&#39;\mathbf{R}^{-1}\mathbf{Z} + \mathbf{G}^{-1}
\end{array}
\right]
\left[
\begin{array}{c}
\mathbf{\hat{b}}\\
\mathbf{\hat{u}}
\end{array}
\right]
=
\left[
\begin{array}{l}
\mathbf{X}&#39;\mathbf{R}^{-1}\mathbf{y} \\
\mathbf{Z}&#39;\mathbf{R}^{-1}\mathbf{y}
\end{array}
\right].
\]</span></p>
<p>For simplicity, we here assume <span class="math inline">\(\mathrm{var}(\mathbf{u}) = \mathbf{I}\sigma_s^2\)</span> and <span class="math inline">\(\mathrm{var}(\mathbf{e}) = \mathbf{I}\sigma_e^2\)</span> so, the mixed model equations reduce to <span class="math display">\[
\left[
\begin{array}{ll}
\mathbf{X}&#39;\mathbf{X}\sigma_e^{-2} &amp; \mathbf{X}&#39;\mathbf{Z}\sigma_e^{-2} \\
\mathbf{Z}&#39;\mathbf{X}\sigma_e^{-2} &amp; \mathbf{Z}&#39;\mathbf{Z}\sigma_e^{-2} + \mathbf{I}\sigma_s^{-2}
\end{array}
\right]
\left[
\begin{array}{c}
\mathbf{\hat{b}}\\
\mathbf{\hat{u}}
\end{array}
\right]
=
\left[
\begin{array}{l}
\mathbf{X}&#39;\mathbf{y}\sigma_e^{-2} \\
\mathbf{Z}&#39;\mathbf{y}\sigma_e^{-2}
\end{array}
\right]
\]</span></p>
<p>The system of mixed model equations is often presented as <span class="math display">\[
\left[
\begin{array}{ll}
\mathbf{X}&#39;\mathbf{X} &amp; \mathbf{X}&#39;\mathbf{Z} \\
\mathbf{Z}&#39;\mathbf{X} &amp; \mathbf{Z}&#39;\mathbf{Z} + \mathbf{I}\lambda
\end{array}
\right]
\left[
\begin{array}{c}
\mathbf{\hat{b}}\\
\mathbf{\hat{u}}
\end{array}
\right]
=
\left[
\begin{array}{l}
\mathbf{X}&#39;\mathbf{y} \\
\mathbf{Z}&#39;\mathbf{y}
\end{array}
\right]
\]</span> where <span class="math inline">\(\lambda=\sigma_e^2/\sigma_s^2\)</span>. This model looks like a simple sire model with unrelated sires in animal breeding.</p>
<p>Note that BLUPF90 always creates the equations with <span class="math inline">\(\mathbf{R}^{-1}\)</span>; <span class="math inline">\(\lambda\)</span> is never calculated. Precisely, <span class="math inline">\(1/\sigma_e^2\)</span> is always calculated and accumulated to the left-hand side (LHS) and <span class="math inline">\(1/\sigma_s^2\)</span> is also added to LHS. Basically, the program needs explicit values for variance components. Here we assume <span class="math inline">\(\sigma_s^2 = 1.0\)</span> and <span class="math inline">\(\sigma_e^2 = 2.0\)</span>.</p>
<p>We can use exactly the same data file shown before. The file name is altered just for our convenience.</p>
<pre data-language="text" data-caption="data2.txt"><code>3.0  1  1  1.0
2.0  1  2  1.0
4.0  1  1  2.0
6.0  2  2  2.0
3.0  2  1  1.0
6.0  2  2  2.0
6.0  3  1  2.0
6.0  3  2  1.0
8.0  3  1  1.0
4.0  3  2  2.0</code></pre>
<p>The parameter file is shown below.</p>
<pre data-language="blupf90" data-caption="param2.txt"><code>DATAFILE
data2.txt
NUMBER_OF_TRAITS
1
NUMBER_OF_EFFECTS
3
OBSERVATION(S)
1
WEIGHT(S)

EFFECTS:
2 3 cross
3 2 cross
4 1 cov
RANDOM_RESIDUAL VALUES
2.0
RANDOM_GROUP
2
RANDOM_TYPE
diagonal
FILE

(CO)VARIANCES
1.0</code></pre>
<p>The first 7 keywords are the same as used in the fixed effect models. To define the random effect, we use 4 extra keywords<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> just placed after the common keywords.</p>
<ol type="1">
<li><code>RANDOM GROUP</code> = showing which effect is random in the <code>EFFECTS</code> block
<ul>
<li>2 for the second line (effect 2) in <code>EFFECTS</code> is the random effect</li>
</ul></li>
<li><code>RANDOM_TYPE</code> = covariance structure
<ul>
<li>diagonal for identity covariance matrix i.e. diagonals only</li>
</ul></li>
<li><code>FILE</code> = additional file for the covariance structure
<ul>
<li>empty for no information needed here</li>
</ul></li>
<li><code>(CO)VARIANCES</code> = variance component <span class="math inline">\(\sigma_s^2\)</span>
<ul>
<li>1.0 for the variance</li>
</ul></li>
</ol>
<p>If you have 2 or more random effects (e.g., permanent environmental or maternal effect), you can add another extra 4 keywords to the parameter file. We will see such a case later. The solutions will be very different from the previous one which assumes effect 2 is a fixed effect.</p>
<pre data-language="text" data-caption="solutions"><code>trait/effect level  solution
   1   1         1      2.30434783
   1   1         2      4.26086957
   1   1         3      5.28260870
   1   2         1      0.17391304
   1   2         2     -0.17391304
   1   3         1      0.47826087</code></pre>
<p>The solution file contains both BLUE for the fixed effects and BLUP for the random effects. The first column is always 1 because it is a single-trait model; the 2nd column shows the effect number from 1 to 3; the 3rd column shows the level in each effect; the fourth column contains the solutions. The first 3 solutions are for the effct 1 (<span class="math inline">\(A_i\)</span>), the next 2 solutions for effect 2 (<span class="math inline">\(S_j\)</span>) and the last 1 solution for the regression (<span class="math inline">\(\beta\)</span>). Details are: <span class="math inline">\(\hat{A}_1 = 2.30\)</span>, <span class="math inline">\(\hat{A}_2 = 4.26\)</span>, <span class="math inline">\(\hat{A}_3 = 5.28\)</span>, <span class="math inline">\(\hat{S}_1 = 0.17\)</span>, <span class="math inline">\(\hat{S}_2 = -0.17\)</span> and <span class="math inline">\(\hat{\beta} = 0.48\)</span>.</p>
<h2 id="the-animal-model">The animal model</h2>
<p>The animal model specifically refers to a mixed model with individual additive genetic effect as a random effect. Genetic covariances between animals are considered with a numerator relationship matrix. You need a pedigree file for this model. In this section, we assume the same model above with additive genetic effects. An animal has either one observation or no observation (where the animal is only in a pedigree file). The mathematical model is the following: <span class="math display">\[
y_{ijk} = A_i + S_j + \beta x_k + u_k + e_{ijk}
\]</span> where <span class="math inline">\(u_k\)</span> is the additive genetic effect for an animal <span class="math inline">\(k\)</span>. Here we treat <span class="math inline">\(S_j\)</span> as a fixed effect. The system of mixed model equations is <span class="math display">\[
\left[
\begin{array}{ll}
\mathbf{X}&#39;\mathbf{X}\sigma_e^{-2} &amp; \mathbf{X}&#39;\mathbf{Z}\sigma_e^{-2} \\
\mathbf{Z}&#39;\mathbf{X}\sigma_e^{-2} &amp; \mathbf{Z}&#39;\mathbf{Z}\sigma_e^{-2} + \mathbf{A}^{-1}\sigma_u^{-2}
\end{array}
\right]
\left[
\begin{array}{c}
\mathbf{\hat{b}}\\
\mathbf{\hat{u}}
\end{array}
\right]
=
\left[
\begin{array}{l}
\mathbf{X}&#39;\mathbf{y}\sigma_e^{-2} \\
\mathbf{Z}&#39;\mathbf{y}\sigma_e^{-2}
\end{array}
\right]
\]</span></p>
<p>where <span class="math inline">\(\mathbf{A}\)</span> is a numerator relationship matrix, <span class="math inline">\(\sigma_u^2\)</span> is the additive genetic variance, and <span class="math inline">\(\sigma_e^2\)</span> is the residual variance.</p>
<p>We further extend the data table to add an animal’s ID (code). We show the actual data file to be used in this analysis.</p>
<pre data-language="text" data-caption="data3.txt"><code>  3.0  1  1  1.0   6
  2.0  1  2  1.0   9
  4.0  1  1  2.0  12
  6.0  2  2  2.0   7
  3.0  2  1  1.0  10
  6.0  2  2  2.0  13
  6.0  3  1  2.0   8
  6.0  3  2  1.0  11
  8.0  3  1  1.0  14
  4.0  3  2  2.0  15</code></pre>
<p>In the data file, animal ID starts with 6; it means animals 1 to 5 have no observation so, they are not included in the data file. The order of animal ID is totally arbitrary, and you don’t have to order the animals chronologically.</p>
<p>We show the pedigree file below. Pedigree information consists of 3 columns: animal ID, its sire’s ID, and its dam’s ID. If an animal’s parent is unknown (missing), you should put <code>0</code>. The following is the pedigree in this analysis.</p>
<pre data-language="text" data-caption="pedigree3.txt"><code>  1   0   0
  2   0   0
  3   0   0
  4   0   0
  5   0   0
  6   0   0
  7   2   5
  8   1   4
  9   2   3
 10   7   6
 11   7   4
 12  11   8
 13  11  10
 14   9  13
 15  11  10</code></pre>
<p>The individual ID should be an integer value, and it corresponds to one in the data file. If your data has non-integer animal IDs, you can use the RENUMF90 program to replace the characters with integer values in both pedigree and data. You don’t have to records the ID is chronological order. Also, you don’t need to sort the ID in this file.</p>
<p>The basic format of the parameter file is the same as the previous one. We assume <span class="math inline">\(\sigma_a^2 = 0.5\)</span> and <span class="math inline">\(\sigma_e^2 = 2.0\)</span>.</p>
<pre data-language="blupf90" data-caption="param3.txt"><code>DATAFILE
data3.txt
NUMBER_OF_TRAITS
1
NUMBER_OF_EFFECTS
4
OBSERVATION(S)
1
WEIGHT(S)

EFFECTS:
2  3 cross
3  2 cross
4  1 cov
5 15 cross
RANDOM_RESIDUAL VALUES
2.0
RANDOM_GROUP
4
RANDOM_TYPE
add_animal
FILE
pedigree3.txt
(CO)VARIANCES
0.5</code></pre>
<p>There are 6 modifications in this file compared to the previous one.</p>
<ol type="1">
<li><code>NUMBER_OF_EFFECTS</code> = Because the additive genetic effect is added, the number of effects should be incremented.
<ul>
<li>The total number of effects is 4.</li>
</ul></li>
<li><code>EFFECTS:</code> = The added effect is in the 4th row.
<ul>
<li><code>5</code> for the position of ID in the data file, 15 for the total number of animals (in the pedigree), and <code>cross</code> for cross-classified effect.</li>
</ul></li>
<li><code>RANDOM_GROUP</code> = It represents which effect is random in <code>EFFECTS:</code>
<ul>
<li>The 4th effect in the block is a random effect.</li>
</ul></li>
<li><code>RANDOM_TYPE</code> = covariance structure
<ul>
<li><code>add_animal</code> for additive genetic effect</li>
</ul></li>
<li><code>FILE</code> = pedigree file
<ul>
<li><code>pedigree4.txt</code></li>
</ul></li>
<li><code>(CO)VARIANCES</code> = the variance component of this random effect
<ul>
<li><span class="math inline">\(\sigma_{a}^{2}=0.5\)</span></li>
</ul></li>
</ol>
<p>Now you can run BLUPF90 and obtain the solutions.</p>
<pre data-language="text" data-caption="solutions"><code>trait/effect level  solution
   1   1         1      0.20259645
   1   1         2      2.21996461
   1   1         3      3.16680208
   1   2         1      2.27537292
   1   2         2      1.71160538
   1   3         1      0.52442755
   1   4         1     -0.03487115
   1   4         2      0.08280493
   1   4         3      0.03843921
   1   4         4      0.04492008
   1   4         5      0.04436203
   1   4         6     -0.17565609
   1   4         7      0.10794668
   1   4         8     -0.02984646
   1   4         9      0.09906236
   1   4        10     -0.25282594
   1   4        11      0.15622415
   1   4        12      0.10874296
   1   4        13      0.16426465
   1   4        14      0.34296714
   1   4        15     -0.25707431</code></pre>
<p>The solution file contains both BLUE for the fixed effects and BLUP for the random effects. The first column is always 1 because it is a single-trait model; the 2nd column shows the effect number from 1 to 4; the 3rd column shows the level in each effect; the fourth column contains the solutions. The first 3 solutions are for effect 1 (<span class="math inline">\(A_i\)</span>), the next 2 solutions for effect 2 (<span class="math inline">\(S_j\)</span>), the next 1 solution for the regression (<span class="math inline">\(\beta\)</span>) and the remaining 15 solutions for the additive genetic effect i.e., estimated breeding values (<span class="math inline">\(u_k\)</span>). Details are: <span class="math inline">\(\hat{A}_1 = 0.203\)</span>, <span class="math inline">\(\hat{A}_2 = 2.220\)</span>, <span class="math inline">\(\hat{A}_3 = 3.167\)</span>, <span class="math inline">\(\hat{S}_1 = 2.275\)</span>, <span class="math inline">\(\hat{S}_2 = 1.711\)</span>, <span class="math inline">\(\hat{\beta} = 0.524\)</span>, <span class="math inline">\(\hat{u}_1 = -0.035\)</span>, <span class="math inline">\(\hat{u}_2 = 0.083\)</span>, <span class="math inline">\(\hat{u}_3 = 0.038\)</span>, and so on.</p>
<h2 id="more-than-1-random-effect">More than 1 random effect</h2>
<p>We often meet a model with more than 1 random effect such as repeatability model (additive genetic + permanent environmental [PE] effect) or maternal effect model (direct + maternal + maternal PE effect). BLUPF90 supports such a complicated model. We assume the same animal model described above except for <span class="math inline">\(S_j\)</span> as random: <span class="math display">\[
y_{ijk} = A_i + S_j +\beta x_k + u_k + e_{ijk}
\]</span> where <span class="math inline">\(S_j\)</span> and <span class="math inline">\(u_k\)</span> are random effects. To perform the analysis, we can use the same data file and the pedigree file. We assume that the two random effects <span class="math inline">\(S_{j}\)</span> and <span class="math inline">\(u_{k}\)</span> are not related to each other and <span class="math inline">\(\sigma_s^2 = 1.0\)</span>, <span class="math inline">\(\sigma_u^2 = 0.5\)</span> and <span class="math inline">\(\sigma_e^2 = 2.0\)</span>. We need to modify the parameter file to include additional random effect.</p>
<pre data-language="blupf90" data-caption="param3a.txt"><code>DATAFILE
data3.txt
NUMBER_OF_TRAITS
1
NUMBER_OF_EFFECTS
4
OBSERVATION(S)
1
WEIGHT(S)

EFFECTS:
2  3 cross
3  2 cross
4  1 cov
5 15 cross
RANDOM_RESIDUAL VALUES
2.0
RANDOM_GROUP
4
RANDOM_TYPE
add_animal
FILE
pedigree3.txt
(CO)VARIANCES
0.5
RANDOM_GROUP
2
RANDOM_TYPE
diagonal
FILE

(CO)VARIANCES
1.0</code></pre>
<p>We just a set of 4 keywords (<code>RANDOM_GROUP</code>, <code>RANDOM_TYPE</code>, <code>FILE</code> and <code>(CO)VARIANCES</code>) to the last parameter file for the additional random effect <span class="math inline">\(S_{j}\)</span>. In other words, such 4 keywords are optional; you can add the 4 keywords as you include one more random effect if the effects are unrelated to each other.</p>
<p>If the random effects are correlated with each other, you should use a different way. This happens in a maternal effect model (direct and maternal genetic effect) and random regression model (random regression coefficients). Multiple-trait model is also another story. We do not explain such cases here but we will consider them in later chapters.</p>
<p>The solutions are shown below.</p>
<pre data-language="text" data-caption="solutions"><code>trait/effect level  solution
   1   1         1      2.27101829
   1   1         2      4.24566929
   1   1         3      5.21524118
   1   2         1      0.18586035
   1   2         2     -0.18586066
   1   3         1      0.49101139
   1   4         1     -0.01963655
   1   4         2      0.06556686
   1   4         3      0.02911205
   1   4         4      0.04793111
   1   4         5      0.03646405
   1   4         6     -0.15943505
   1   4         7      0.08747653
   1   4         8     -0.00548994
   1   4         9      0.07644881
   1   4        10     -0.24829955
   1   4        11      0.13527276
   1   4        12      0.12002543
   1   4        13      0.15461713
   1   4        14      0.33690598
   1   4        15     -0.27372367</code></pre>
<p>The order of the solutions is the same as the previous animal model but the effect 2 is now a random effect. The order of the solutions is determined using <code>EFFECTS:</code> block in the parameter file. So even if you add more random effects, the order will not be changed.</p>
<h2 id="remarks">Remarks</h2>
<p>BLUPF90 builds the mixed model equations simply following the parameter file. Even if your parameter file has no fixed effect (i.e., it has random effects only), the program doesn’t add any fixed effect to the model. Without any fixed effects, the solutions may be nonsense. If you want to perform a random effect model with the general mean, you should prepare an additional column containing 1 in the data file and describe it as a fixed effect in the parameter file.</p>
<p>In the animal model with <code>add_animal</code>, BLUPF90 doesn’t consider inbreeding; <span class="math inline">\(\mathbf{A}^{-1}\)</span> is constructed with Henderson’s method ignoring inbreeding. BLUPF90 supports <span class="math inline">\(\mathbf{A}^{-1}\)</span> with inbreeding but the program doesn’t calculate the inbreeding coefficients. The user should calculate the inbreeding coefficients and put them into the pedigree file with a special format. With this special pedigree file and the use of <code>add_an_upginb</code> (instead of <code>add_animal</code>), the inbreeding will be successfully incorporated. RENUMF90 can prepare such a pedigree file.</p>
<h2 id="summary">Summary</h2>
<ul>
<li>BLUPF90 supports linear mixed models with 1 or more random effects.</li>
<li>BLUPF90 needs 3 text files: data, pedigree and parameter files.</li>
<li>A pedigree file is needed if you conduct genetic analyses.</li>
<li>The pedigree file should contain 3 columns: animal ID, sire ID, and dam ID. The ID must be an integer value.</li>
<li>To define a random effect, add 4 keywords (<code>RANDOM_GROUP</code>, <code>RANDOM_TYPE</code>, <code>FILE</code> and <code>(CO)VARIANCES</code>) and the corresponding values to the parameter file.</li>
<li>The order of the solutions depends on the <code>EFFECTS:</code> block in the parameter file.</li>
<li>You should manually add the general mean if you use a random effect model.</li>
<li>With <code>add_animal</code>, inbreeding is ignored in the calculation of <span class="math inline">\(\mathbf{A}^{-1}\)</span>.</li>
</ul>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>This <span class="math inline">\(\mathbf{G}\)</span> does not mean the genomic relationship matrix. This is the traditional notation describing a covariance structure of random effects.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩</a></p></li>
<li id="fn2" role="doc-endnote"><p>The common 7 keywords build the design-matrix parts in the mixed model equations i.e., <span class="math inline">\(\mathbf{X}&#39;\mathbf{X}\)</span>, <span class="math inline">\(\mathbf{X}&#39;\mathbf{Z}\)</span>, <span class="math inline">\(\mathbf{Z}&#39;\mathbf{X}\)</span> and <span class="math inline">\(\mathbf{Z}&#39;\mathbf{Z}\)</span>. The additional 4 keywords provide the covariance structure, and <span class="math inline">\(\mathbf{G}^{-1}\)</span><a href="#fnref2" class="footnote-back" role="doc-backlink">↩</a></p></li>
</ol>
</section>
</article>
</body>
</html>
